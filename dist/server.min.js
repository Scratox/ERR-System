"use strict";var express=require("express"),bodyParser=require("body-parser"),db=require("./db"),mysql=require("mysql2"),app=express(),PORT=process.env.PORT||8888;app.use(express.static("public")),app.set("view engine","pug"),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0}));var pool=mysql.createPool({host:"127.0.0.1",user:"root",password:"",database:"examination_rectifier",waitForConnections:!0,connectionLimit:10,queueLimit:0}),getDepartmentsRadio=function(e,t,o){db.query("SELECT DepartmentName FROM department",function(e,r){if(e)return console.error("Error fetching departments:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <input type="radio" name="department" value="'.concat(e.DepartmentName,'">\n      <label>').concat(e.DepartmentName,"</label>\n    ")});t.locals.getDepartmentsRadio=n.join(""),o()})},getModulesDropdown=function(e,t,o){db.query("SELECT ModuleName FROM modules",function(e,r){if(e)return console.error("Error fetching modules:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <option value="'.concat(e.ModuleName,'">').concat(e.ModuleName,"</option>\n    ")});t.locals.getModulesDropdown='<select name="modules">'.concat(n.join(""),"</select>"),o()})},getTeachersDropdown=function(e,t,o){db.query("SELECT TeacherName FROM teachers",function(e,r){if(e)return console.error("Error fetching teachers:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <option value="'.concat(e.TeacherName,'">').concat(e.TeacherName,"</option>\n    ")});t.locals.getTeachersDropdown='<select name="teachers">'.concat(n.join(""),"</select>"),o()})},authenticateUser=function(t,e,o){db.query("SELECT * FROM users WHERE Username = ? AND Password = ?",[t,e],function(e,r){if(e)return console.error("Error during authentication:",e),o(e,null);if(0===r.length)return console.log("User not found during authentication for username:",t),o(null,null);var n=r[0];console.log("User found during authentication:",n),o(null,n)})};app.post("/login",function(e,n){var r=e.body,t=r.username,o=r.password;authenticateUser(t,o,function(e,r){e?n.send("Error during authentication"):r?"Student"===r.UserRole?n.redirect("/student"):"Teacher"===r.UserRole?n.redirect("/teacher"):n.send("Invalid user role"):n.send("Invalid credentials")})}),app.get("/student",getDepartmentsRadio,getModulesDropdown,getTeachersDropdown,function(e,r){var n={getDepartmentsRadio:r.locals.getDepartmentsRadio,getModulesDropdown:r.locals.getModulesDropdown,getTeachersDropdown:r.locals.getTeachersDropdown};r.render("student",n)}),app.post("/submit-issue",function(e,n){var r=[e.body.description,(new Date).toISOString(),"Pending"].filter(function(e){return null!=e});db.query("\n    INSERT INTO problemsubmissions (ProblemDescription, SubmissionDate, Status)\n    VALUES (?, ?, ?)\n  ",r,function(e,r){e?(console.error("Error inserting data into problemsubmissions table:",e),n.status(500).send("Internal Server Error")):(console.log("Data inserted successfully into problemsubmissions table"),n.send("Form submitted successfully"))})}),app.get("/teacher",function(e,n){db.query("SELECT * FROM problemsubmissions",function(e,r){e?(console.error("Database query error:",e),n.render("teacher",{result:null,error:"Error during database query"})):n.render("teacher",{result:r})})}),app.get("/",function(e,r){r.render("index")}),app.get("/login",function(e,r){r.render("login")}),app.get("/submit-issue",function(e,r){r.render("student")}),app.get("/feedback",function(e,r){r.render("feedback")}),app.get("/submitted-feedback",function(e,r){r.render("submitted-feedback")}),app.get("/home",function(e,r){r.render("home")}),app.post("/feedback",function(e,n){var r=e.body,t=[r.StudentID,r.TeacherID,r.FeedbackText,r.FeedbackDate,r.ExamID];pool.query("INSERT INTO feedback (StudentID, TeacherID, FeedbackText, FeedbackDate, ExamID) VALUES (?, ?, ?, ?, ?)",t,function(e,r){if(e)return console.error(e),void n.status(500).send("Internal Server Error");console.log("Feedback submitted successfully."),n.redirect("/feedback")})}),app.get("/submitted-feedback/:studentID",function(e,t){var r=e.params.studentID;pool.query("SELECT * FROM feedback WHERE StudentID = ?",[r],function(e,r){if(e)return console.error(e),void t.status(500).send("Internal Server Error");var n=r;t.render("submitted-feedback",{feedbackData:n})})}),app.listen(PORT,function(){console.log("Server is running on http://localhost:".concat(PORT))});
//# sourceMappingURL=server.min.js.map
