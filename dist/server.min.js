"use strict";var express=require("express"),bodyParser=require("body-parser"),db=require("./db"),app=express(),PORT=process.env.PORT||8888;app.use(express.static("public")),app.set("view engine","pug"),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0}));var getDepartmentsRadio=function(e,t,o){db.query("SELECT DepartmentName FROM department",function(e,r){if(e)return console.error("Error fetching departments:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <input type="radio" name="department" value="'.concat(e.DepartmentName,'">\n      <label>').concat(e.DepartmentName,"</label>\n    ")});t.locals.getDepartmentsRadio=n.join(""),o()})},getModulesDropdown=function(e,t,o){db.query("SELECT ModuleName FROM modules",function(e,r){if(e)return console.error("Error fetching modules:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <option value="'.concat(e.ModuleName,'">').concat(e.ModuleName,"</option>\n    ")});t.locals.getModulesDropdown='<select name="modules">'.concat(n.join(""),"</select>"),o()})},getTeachersDropdown=function(e,t,o){db.query("SELECT TeacherName FROM teachers",function(e,r){if(e)return console.error("Error fetching teachers:",e),t.status(500).send("Internal Server Error");var n=r.map(function(e){return'\n      <option value="'.concat(e.TeacherName,'">').concat(e.TeacherName,"</option>\n    ")});t.locals.getTeachersDropdown='<select name="teachers">'.concat(n.join(""),"</select>"),o()})},authenticateUser=function(t,e,o){db.query("SELECT * FROM users WHERE Username = ? AND Password = ?",[t,e],function(e,r){if(e)return console.error("Error during authentication:",e),o(e,null);if(0===r.length)return console.log("User not found during authentication for username:",t),o(null,null);var n=r[0];console.log("User found during authentication:",n),o(null,n)})};app.post("/login",function(e,n){var r=e.body,t=r.username,o=r.password;authenticateUser(t,o,function(e,r){e?n.send("Error during authentication"):r?"Student"===r.role?n.redirect("/student"):"Teacher"===r.role?n.redirect("/teacher"):n.send("Invalid user role"):n.send("Invalid credentials")})}),app.get("/student",getDepartmentsRadio,getModulesDropdown,getTeachersDropdown,function(e,r){var n={getDepartmentsRadio:r.locals.getDepartmentsRadio,getModulesDropdown:r.locals.getModulesDropdown,getTeachersDropdown:r.locals.getTeachersDropdown};r.render("student",n)}),app.get("/teacher",function(e,n){db.query("SELECT * FROM problemsubmissions",function(e,r){e?(console.error("Database query error:",e),n.render("teacher",{result:null,error:"Error during database query"})):n.render("teacher",{result:r})})}),app.get("/",function(e,r){r.render("index")}),app.get("/login",function(e,r){r.render("login")}),app.get("/submit-issue",function(e,r){r.render("student")}),app.use(function(e,r,n,t){console.error(e.stack),n.status(500).send("Something went wrong!")}),app.listen(PORT,function(){console.log("Server is running on http://localhost:".concat(PORT))});
//# sourceMappingURL=server.min.js.map
